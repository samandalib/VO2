# Cloud Deployment Guide

## 🌐 Hosting Architecture

**Recommended Setup**: Vercel (Frontend) + Railway (Backend + Database)

```
Frontend (React/Vite) → Vercel
Backend (Express/Node) → Railway
Database (PostgreSQL) → Railway
```

**Alternative**: Render.com (Full-stack hosting)

## 🚀 Quick Start Deployment

### Option 1: Vercel + Railway (Recommended)

#### 1. Deploy Backend to Railway

```bash
# Install Railway CLI
npm install -g @railway/cli

# Login to Railway
railway login

# Create new project
railway new vo2max-backend

# Add PostgreSQL database
railway add postgresql

# Deploy backend
railway up
```

#### 2. Deploy Frontend to Vercel

```bash
# Install Vercel CLI
npm install -g vercel

# Login to Vercel
vercel login

# Deploy frontend
vercel

# For production deployment
vercel --prod
```

### Option 2: Render.com (All-in-one)

1. Connect your GitHub repository to Render
2. Render will automatically detect `render.yaml`
3. Configure environment variables in Render dashboard
4. Deploy with one click

## 🔧 Detailed Setup Instructions

### Railway Backend Setup

#### 1. Create Railway Project

```bash
railway new vo2max-backend --template nodejs
cd vo2max-backend
```

#### 2. Add Database

```bash
# Add PostgreSQL service
railway add postgresql

# Get database URL
railway env
```

#### 3. Configure Environment Variables

In Railway dashboard, add these variables:

```bash
NODE_ENV=production
PORT=3000
DATABASE_URL=postgresql://... # Auto-generated by Railway
JWT_SECRET=your-super-secure-jwt-secret
GOOGLE_CLIENT_ID=your-google-oauth-client-id
SENTRY_DSN=your-sentry-dsn
```

#### 4. Deploy Backend

```bash
# Deploy from local
railway up

# Or connect GitHub repo for auto-deploy
railway github
```

### Vercel Frontend Setup

#### 1. Install and Configure

```bash
npm install -g vercel
vercel login
```

#### 2. Configure Environment Variables

In Vercel dashboard, add these variables:

```bash
# Production
VITE_API_URL=https://your-backend.railway.app
VITE_APP_ENV=production
VITE_GOOGLE_CLIENT_ID=your-google-oauth-client-id

# Staging (if using preview deployments)
VITE_API_URL=https://your-backend-staging.railway.app
VITE_APP_ENV=staging
```

#### 3. Deploy Frontend

```bash
# Preview deployment
vercel

# Production deployment
vercel --prod
```

## 🗄️ Database Setup

### Railway PostgreSQL

1. **Create Database**: Automatically created when you add PostgreSQL service
2. **Get Connection Info**: Available in Railway dashboard
3. **Run Migrations**: Use connection string in your CI/CD or locally

```bash
# Set DATABASE_URL environment variable
export DATABASE_URL="postgresql://..."

# Run migrations
npx prisma migrate deploy

# Seed database (if needed)
npm run db:seed
```

### Database Configuration

```yaml
# railway.toml
[environments.production]
[environments.production.variables]
DATABASE_URL = "${{ POSTGRES.DATABASE_URL }}"
```

## 🔒 Environment Variables Setup

### Required Variables by Service

#### Railway (Backend)

```bash
NODE_ENV=production
PORT=3000
DATABASE_URL=postgresql://...  # Auto-generated
JWT_SECRET=your-jwt-secret
GOOGLE_CLIENT_ID=your-google-client-id
SENTRY_DSN=your-sentry-dsn
```

#### Vercel (Frontend)

```bash
VITE_API_URL=https://your-backend.railway.app
VITE_APP_ENV=production
VITE_GOOGLE_CLIENT_ID=your-google-client-id
```

### Setting Environment Variables

#### Railway

```bash
# Via CLI
railway env set JWT_SECRET="your-secret"

# Via Dashboard
# 1. Go to your project dashboard
# 2. Click on Variables tab
# 3. Add key-value pairs
```

#### Vercel

```bash
# Via CLI
vercel env add JWT_SECRET

# Via Dashboard
# 1. Go to project settings
# 2. Click Environment Variables
# 3. Add variables for each environment
```

## 🔄 CI/CD Integration

### Update GitHub Secrets

Add these secrets to your GitHub repository:

```bash
# Railway
RAILWAY_TOKEN=your-railway-token

# Vercel
VERCEL_TOKEN=your-vercel-token
VERCEL_ORG_ID=your-org-id
VERCEL_PROJECT_ID=your-project-id

# Database URLs
STAGING_DATABASE_URL=postgresql://...
PRODUCTION_DATABASE_URL=postgresql://...

# Application URLs
STAGING_URL=https://your-app-staging.vercel.app
PRODUCTION_URL=https://your-app.vercel.app
```

### Modified Deployment Workflows

Update `.github/workflows/deploy-staging.yml`:

```yaml
- name: Deploy to Railway
  run: |
    railway login --token ${{ secrets.RAILWAY_TOKEN }}
    railway environment staging
    railway up --detach

- name: Deploy to Vercel
  run: |
    vercel --token ${{ secrets.VERCEL_TOKEN }} --confirm
```

## 🌐 Domain and SSL Setup

### Custom Domain on Vercel

1. **Add Domain**: In Vercel dashboard → Domains
2. **Configure DNS**: Point your domain to Vercel
3. **SSL**: Automatically handled by Vercel

```bash
# DNS Configuration
CNAME www your-app.vercel.app
A     @   76.76.19.61
```

### Custom Domain on Railway

1. **Add Domain**: In Railway dashboard → Settings → Domains
2. **Configure DNS**: Point subdomain to Railway
3. **SSL**: Automatically handled by Railway

```bash
# DNS Configuration for API subdomain
CNAME api your-app.railway.app
```

## 📊 Monitoring Setup

### Error Tracking with Sentry

1. **Create Sentry Project**
2. **Get DSN**
3. **Add to Environment Variables**

```bash
# Add to Railway and Vercel
SENTRY_DSN=https://...@sentry.io/project-id
```

### Uptime Monitoring

#### UptimeRobot (Free)

1. Create account at uptimerobot.com
2. Add monitors for:
   - Frontend: `https://your-app.vercel.app`
   - Backend: `https://your-api.railway.app/health`

#### StatusPage.io (Professional)

1. Create status page
2. Configure monitors
3. Set up alerts

## 💾 Backup Strategy

### Database Backups

#### Railway Automatic Backups

- Enabled by default on paid plans
- 7-day retention
- Point-in-time recovery

#### Custom Backup Script

```bash
# Add to Railway as a scheduled job
#!/bin/bash
pg_dump $DATABASE_URL > backup-$(date +%Y%m%d).sql
# Upload to cloud storage (S3, Google Cloud, etc.)
```

### Code Backups

- GitHub repository serves as code backup
- Use GitHub Actions for automated releases
- Tag important versions

## 🚨 Troubleshooting

### Common Issues

#### Railway Deployment Fails

```bash
# Check logs
railway logs

# Check build
railway shell
npm run build
```

#### Vercel Build Fails

```bash
# Check build locally
npm run build

# Check environment variables
vercel env ls
```

#### Database Connection Issues

```bash
# Test connection
railway shell
npm run db:test

# Check DATABASE_URL format
echo $DATABASE_URL
```

### Performance Optimization

#### Railway

- Use smaller Docker images
- Optimize dependency installation
- Enable Railway's build cache

#### Vercel

- Optimize bundle size (already done in vite.config.ts)
- Use Vercel's Edge Functions if needed
- Enable analytics and monitoring

## 📋 Deployment Checklist

### Pre-deployment

- [ ] Environment variables configured
- [ ] Database migrations ready
- [ ] Build process tested locally
- [ ] Domain/DNS configured

### Staging Deployment

- [ ] Deploy backend to Railway staging
- [ ] Deploy frontend to Vercel preview
- [ ] Run integration tests
- [ ] Verify all functionality

### Production Deployment

- [ ] Manual approval obtained
- [ ] Deploy backend to Railway production
- [ ] Deploy frontend to Vercel production
- [ ] Run smoke tests
- [ ] Monitor for issues

### Post-deployment

- [ ] Verify health checks
- [ ] Monitor error rates
- [ ] Check performance metrics
- [ ] Update documentation

## 💰 Cost Estimation

### Free Tier Limits

#### Railway

- $5/month free credit
- Shared CPU/memory
- 500 hours/month

#### Vercel

- 100 GB bandwidth/month
- 6,000 build minutes/month
- Unlimited static deployments

### Paid Tiers

#### Railway ($5-20/month)

- Dedicated resources
- More build minutes
- Priority support

#### Vercel ($20-50/month)

- More bandwidth
- Advanced analytics
- Team collaboration

**Estimated Monthly Cost**: $10-30 for small production app

## 🎯 Next Steps

1. **Choose hosting provider** (Vercel + Railway recommended)
2. **Set up accounts** and connect GitHub
3. **Configure environment variables**
4. **Test deployment** with staging environment
5. **Set up monitoring** and alerts
6. **Configure custom domains**
7. **Implement backup strategy**

Ready for production deployment! 🚀
